---
title: "04 wordclouds"
output: pdf_document
date: "2023-09-04"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(tidytext)
library(wordcloud2)
library(tvthemes)
library(wordcloud)
library(RColorBrewer)
library(png)
```

```{r}
rm(list = ls())

if (Sys.info()["user"]=='hugosalas'){
  BASE_PATH = "/Users/hugosalas/Roemer & Salas/"
} else if (Sys.info()["user"]=='aleroemer'){
  BASE_PATH = "~/My Drive/DiscursoUSA_MX/"
}

DATA_PATH =  paste0(BASE_PATH, "data/")
CLEAN_DATA_PATH = paste0(DATA_PATH, "clean/")
UTILS_PATH = paste0(BASE_PATH, "USMEX_TextAnalysis/utils/")

source(str_c(UTILS_PATH, 'data_manipulation_utils.R'))
```

### B. Load all relevant files and DF

```{r}
load(paste0(CLEAN_DATA_PATH, "paragraphs_MEXICO"))
```

### C. Tokenize Paragraphs that mention Mexico
```{r}
tokens_df <- unnest_tokens(paragraphs_df, word_tokens, text_paragraph, token = "words")

#eliminate stopwords
data(stop_words)

# Assuming your dataframe is called 'df' and the column containing the tokens is called 'word_tokens'
tokens_df_nosw <- tokens_df %>%
  anti_join(stop_words, by = c("word_tokens" = "word"))
```


### D. Trump Wordcloud. Try 1
```{r}
#cols <- avatar_pal(palette = "AirNomads",n = 7)

exclude = c("mexico", "u.s", "canada", "applause", "united", "trump")

trump_wcloud <- tokens_df_nosw %>%
  filter(last_name == "Trump") %>%
  count(word_tokens) %>%
  arrange(desc(n)) %>%
  filter(n > 1) %>%
  rename(freq = n) %>% 
  filter(!(word_tokens %in% exclude))

### Without shape
wordcloud2(trump_wcloud,size = 1)

### With colors of Mexican flag
wordcloud2(trump_wcloud, size = 1, color = rep(c("#006847", "#ED2939"),2228))

### With Trump's image as shape -- can't get it to work
### Re-installing package from Git
# Troubleshooting: https://github.com/Lchiffon/wordcloud2/issues/12
#"However, if I re-install the package directly from git rather than cran, it works!"
library(devtools)
devtools::install_github("lchiffon/wordcloud2", force = TRUE)
wordcloud2(trump_wcloud, size = 1,figPath = "images/trump2.png", color = rep(c("#006847", "#ED2939"),2228))


# with different images
wordcloud2(trump_wcloud, size = 1,figPath = "images/trump2.png", color = rep(c("#006847", "#ED2939"),2228))
wordcloud2(trump_wcloud, size = 1,figPath = "images/trump.png", color = rep(c("#006847", "#ED2939"),2228))
wordcloud2(trump_wcloud, size = 1,figPath = "images/trump3.png", color = rep(c("#006847", "#ED2939"),2228))


# improvements
wordcloud2(trump_wcloud, 
           size = 1.3,
           figPath = "images/trump2.png",
           color = rep(c("#006847", "#ED2939"),2228))

```











